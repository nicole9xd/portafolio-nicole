<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portafolio - Nicole</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- BOT√ìN CERRAR SESI√ìN -->
  <header>
    <div class="container header-inner">
      <h1>Unidades de Trabajo - Portafolio</h1>
      <button class="btn btn-logout" onclick="cerrarSesion()">Cerrar sesi√≥n</button>
    </div>
  </header>

  <!-- PORTAFOLIO / UNIDADES -->
  <section id="portfolio" class="section">
    <div class="container">
      <h2 class="section-title">Unidades de Trabajo</h2>
      <main class="grid" id="gridSemanas"></main>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contact" class="section">
    <div class="container" style="text-align:center">
      <h2>Contacto</h2>
      <div class="contact-buttons">
        <a class="btn" href="mailto:nicolfloreslp9@gmail.com">üìß Email</a>
        <a class="btn" href="https://www.instagram.com/?hl=es-la" target="_blank">üì∑ Instagram</a>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <p>¬© 2025 Nicole - Portafolio</p>
    </div>
  </footer>

  <script>
    // Configura Supabase
    const supabaseUrl = 'https://kmxnmkjnzhiolfmzdnet.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtteG5ta2puemhpb2xmbXpkbmV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyOTcwMDMsImV4cCI6MjA3Mzg3MzAwM30.KMlip04UmkwBFo29VQtftss9je2HCi7mn_Ls7Ein36g'; // reemplaza con tu anon key real
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Redirige si no hay sesi√≥n activa
    const usuario = JSON.parse(localStorage.getItem("usuarioActivo"));
    if (!usuario) {
      window.location.href = "index.html";
    }

    // Lista de semanas
    const semanas = [
      { num: 1, titulo: "Introducci√≥n y alcance" },
      { num: 2, titulo: "Levantamiento de requerimientos" },
      { num: 3, titulo: "Modelado de procesos (BPMN)" },
      { num: 4, titulo: "Arquitectura (C4 + vistas)" },
      { num: 5, titulo: "Dise√±o de datos (MER ‚Üí SQL)" },
      { num: 6, titulo: "Front-end base" },
      { num: 7, titulo: "Back-end base" },
      { num: 8, titulo: "Autenticaci√≥n" },
      { num: 9, titulo: "Integraci√≥n de datos" },
      { num: 10, titulo: "Pruebas" },
      { num: 11, titulo: "Seguridad" },
      { num: 12, titulo: "DevOps" },
      { num: 13, titulo: "BI & Dashboards" },
      { num: 14, titulo: "Ajustes finales" },
      { num: 15, titulo: "Ensayo de sustentaci√≥n" },
      { num: 16, titulo: "Entrega final" }
    ];

    const grid = document.getElementById('gridSemanas');

    // Crea las tarjetas de cada semana
    semanas.forEach(semana => {
      const card = document.createElement('div');
      card.classList.add('card');
      card.innerHTML = `
        <h3>Semana ${semana.num}</h3>
        <p>${semana.titulo}</p>
        <div class="btn-group">
          <button class="btn" onclick="verArchivo('Semana${semana.num}')">üìÑ Ver</button>
          <label class="btn">
            üìÇ Subir
            <input type="file" style="display:none" onchange="subirArchivo(this, 'Semana${semana.num}')">
          </label>
          <button class="btn btn-delete" onclick="borrarArchivo('Semana${semana.num}')">üóë Borrar</button>
        </div>
        <small id="Semana${semana.num}" class="archivo-subido"></small>
      `;
      grid.appendChild(card);
    });

    // Cargar archivos guardados en localStorage al iniciar
    const archivosGuardados = JSON.parse(localStorage.getItem("archivosSubidos")) || {};
    Object.keys(archivosGuardados).forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.textContent = `‚úÖ Subido: ${archivosGuardados[id].nombre}`;
        el.dataset.url = archivosGuardados[id].url;
      }
    });

    // Subir archivo a Supabase y guardar URL en localStorage
    async function subirArchivo(input, semanaId) {
      const archivo = input.files[0];
      if (!archivo) return alert('Selecciona un archivo primero.');

      const nombreArchivo = `${usuario.email}/${semanaId}-${Date.now()}-${archivo.name}`;

      const { data, error } = await supabase.storage
        .from('archivos_portafolio')
        .upload(nombreArchivo, archivo, { upsert: true });

      if (error) {
        console.error(error);
        alert('‚ùå Error al subir el archivo. Ver consola.');
        return;
      }

      const { data: urlData } = supabase.storage
        .from('archivos_portafolio')
        .getPublicUrl(nombreArchivo);

      // Guardar en localStorage
      archivosGuardados[semanaId] = {
        nombre: archivo.name,
        url: urlData.publicUrl
      };
      localStorage.setItem("archivosSubidos", JSON.stringify(archivosGuardados));

      // Actualizar vista
      const el = document.getElementById(semanaId);
      el.textContent = `‚úÖ Subido: ${archivo.name}`;
      el.dataset.url = urlData.publicUrl;

      alert('‚úÖ Archivo subido correctamente.');
    }

    // Ver archivo
    function verArchivo(id) {
      const el = document.getElementById(id);
      const url = el.dataset.url;
      if (url) {
        window.open(url, '_blank');
      } else {
        alert('‚ö†Ô∏è No hay archivo subido para esta semana.');
      }
    }

    // Borrar archivo
    function borrarArchivo(id) {
      const el = document.getElementById(id);
      el.textContent = '';
      el.dataset.url = '';
      delete archivosGuardados[id];
      localStorage.setItem("archivosSubidos", JSON.stringify(archivosGuardados));
      alert('üóë Archivo eliminado de la vista.');
    }

    // Cerrar sesi√≥n
    function cerrarSesion() {
      localStorage.removeItem("usuarioActivo");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
